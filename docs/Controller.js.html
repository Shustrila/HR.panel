<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Controller.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Controller.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const sqlite3 = require('sqlite3').verbose();
const Worker = require('./Model.js');
const { SQLITE } = require('../config.json');

function Controller() {
  const db = new sqlite3.Database(SQLITE.FULL, (err) => {
	  if (err) throw err;

	  this.serialize(() => this.run(Worker.createTable));
	  this.close();
  });

  this.new = (req, res) => {
    db.run(Worker.createRow(req.body), (err) => {
    	if (err) throw err;

      res.json({
        status: 200,
        massege: 'Роботки добавлен',
      });
    });
  };

  this.getAll = (req, res) => {
    db.all(Worker.index, (err, rows) => {
      if (!err) {
        res.json(rows);
      } else {
        res.json({
          status: 500,
          massege: 'Проблемы с сервером',
        });
      }
    });
  };

  this.update = (req, res) => {
    db.run(Worker.update(req.body), req.params.id, (err) => {
      if (err) throw err;

      res.json({
        status: 200,
        massege: 'Работник изменен',
      });
    });
  };

  this.delete = (req, res) => {
    db.serialize(() => {
      db.run(Worker.deleteRow('?'), req.params.id, (err) => {
        if (!err) {
          res.json({
            status: 200,
            massege: 'Удалено',
          });
        } else {
          res.json({
            status: 500,
            massege: 'Что то пошло нет так',
          });
        }
      });
    });
  };

  this.updateUserUses = (req, res) => {
    db.run(Worker.communicationOfEmployeesToUser(
      req.body.id,
      req.params.token,
    ), (err) => {
      try {
        res.json({
          status: 200,
        });
      } catch (e) {
        res.json({
          satus: 500,
        });
      }
    });
  };

  this.employeeСhange = (req, res) => {
    const params = [req.params.token, req.params.workerID];

    db.run(Worker.communicationOfEmployeesToUser, params, (err) => {
      try {
        res.json({
          status: 200,
          maseege: 'Пользовотель редактирует работника',
        });
      } catch (e) {
        res.json({
          status: 500,
          maseege: 'Проблеммы с сервером',
        });
      }
    });
  };

	/**
	 * @param {params} workerID
	 * @param {status, maseege}
	 */
  this.employeeDelete = (req, res) => {
    const params = [req.params.workerID];

    db.run(Worker.deleteEmployeesToUser, params, (err) => {
      try {
        res.json({
          status: 200,
          maseege: 'Не кто не редактирует пользовотеля',
        });
      } catch (e) {
        res.json({
          status: 500,
          maseege: 'Проблеммы с сервером',
        });
      }
    });
  };
}

module.exports = new Controller();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#employeeDelete">employeeDelete</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Feb 07 2019 20:41:59 GMT+0300 (Moscow Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
